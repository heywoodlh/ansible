---
- name: create heywoodlh
  ansible.builtin.user:
    name: heywoodlh
    shell: /bin/zsh
- name: remove sudo configuration from archinstall script if exists
  ansible.builtin.lineinfile:
    path: /etc/sudoers
    state: absent
    regexp: "^heywoodlh"
    line: "heywoodlh ALL=(ALL) ALL"
    validate: 'visudo -cf %s'
- name: sudo configuration from archinstall script if exists
  ansible.builtin.lineinfile:
    path: /etc/sudoers.d/heywoodlh
    line: "heywoodlh ALL=(ALL) ALL"
    validate: 'visudo -cf %s'
    create: yes
- name: check if dotfiles exist
  ansible.builtin.stat:
    path: /home/heywoodlh/opt/conf
  register: conf_check
- name: check if ~/.bash.d exists (to know if dotfiles should be installed)
  stat:
    path: /home/heywoodlh/.bash.d
  register: bash_d
- name: download dotfiles
  ansible.builtin.git:
    repo: 'https://github.com/heywoodlh/conf'
    dest: '/home/heywoodlh/opt/conf'
  become: yes
  become_user: heywoodlh
  when: not conf_check.stat.exists
- name: install dotfiles
  ansible.builtin.command: "/home/heywoodlh/opt/conf/setup.sh"
  become: yes
  become_user: "heywoodlh"
  args:
    chdir: /home/heywoodlh/opt/conf
  when: not bash_d.stat.exists
- name: make sure bash_profile is sourced by .bashrc
  ansible.builtin.lineinfile:
    path: /home/heywoodlh/.bashrc
    create: yes
    line: "source ~/.bash_profile"
  become: yes
  become_user: "heywoodlh"
