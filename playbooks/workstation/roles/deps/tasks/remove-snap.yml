---
- name: get list of all packages
  package_facts:
     manager: auto
- name: stop and disable snap
  service: 
    name: snapd.service
    state: stopped
    enabled: no
  when: "'snapd' in ansible_facts.packages"
- name: remove snap
  apt:
    name: snapd
    state: absent
    purge: yes
    autoremove: yes
  when: "'snapd' in ansible_facts.packages"
- name: prevent snap installs
  copy:
    src: files/nosnap.pref
    dest: /etc/apt/preferences.d/
    owner: root
    group: root
    mode: 0440
  when: "'snapd' in ansible_facts.packages"
